{
  "hash": "7ba7451832022b77ca05ffbfd480e890",
  "result": {
    "markdown": "---\ntitle:  \"ggplot2: Mastering the basics\"\nauthor: \"Rebecca Barter\"\ncategories: [R, visualization]\noutput:\n  html:\n    toc: true\ndate: 2017-11-17\ndescription: \"Making graphs in R with ggplot2 is easy! This post will cover the basics to get you started on your ggplot2 adventures\" \n---\n\n\nAn interactive Jupyter Notebook version of this tutorial can be found at https://github.com/rlbarter/ggplot2-thw. Feel free to download it and use for your own learning or teaching adventures!\n\n## Useful resources for learning ggplot2\n\n- **ggplot2** book (https://www.amazon.com/dp/0387981403/ref=cm_sw_su_dp?tag=ggplot2-20) by Hadley Wickham\n- **The layered grammar of graphics** (http://vita.had.co.nz/papers/layered-grammar.pdf) by Hadley Wickham\n\n## Materials outline\n\nI will begin by providing an overview of the layered grammar of graphics upon which ggplot2 is built. I will then teach ggplot2 by layering examples on top of one another. Finally, I will introduce some advanced topics such as faceting and themes\n\n1. Layered grammar of graphics\n\n1. Basic ggplot2 plot types\n\n1. Scales, axes, legends and positioning\n\n1. Faceting\n\n1. Themes: deviating from the defaults to produce beautiful graphics\n\nBy the end of this tutorial, you will be able to produce beautiful graphics such as this:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n## The layered grammar of graphics\n\nHadley Wickham built ggplot2 based on a set of principles outlines in his *layered grammar of graphics* (inspired by Wilkinson's original *grammar of graphics*). The basic idea is that a statistical graphic is a mapping from data to aesthetic attributes (such as colour, shape, and size) of geometric objects (such as points, lines, and bars).\n\nWe will use some of this terminology as we progress and discover that each piece of terminology corresponds to a type of object in ggplot2.\n\n- **data**: a data frame containing the variables that you want to visualize\n\n- **geoms**: geometric objects (circles, lines, text) that you will actually see\n\n- **aesthetics**: the mapping from the data to the geographic objects (e.g. by describing position, size, colour, etc)\n\n\n## Basic ggplot2\n\nIn this section, we are going to make our first plot. This plot will be based on the `gapminder` dataset that can be found [here](https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder-FiveYearData.csv). Below, we show the first 6 rows of the `gapminder` dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n# to download the data directly:\ngapminder <- read.csv(\"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder-FiveYearData.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(gapminder)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      country year      pop continent lifeExp gdpPercap\n1 Afghanistan 1952  8425333      Asia  28.801  779.4453\n2 Afghanistan 1957  9240934      Asia  30.332  820.8530\n3 Afghanistan 1962 10267083      Asia  31.997  853.1007\n4 Afghanistan 1967 11537966      Asia  34.020  836.1971\n5 Afghanistan 1972 13079460      Asia  36.088  739.9811\n6 Afghanistan 1977 14880372      Asia  38.438  786.1134\n```\n:::\n:::\n\n\n\nThe first function we will use is `ggplot()`. This function allows us to define the data that we will be using to make the plot, as well as the aesthetic properties that will be mapped to the geometric objects. That is, we will tell ggplot which data (a data frame) we are interested in and how each of the variables in our dataset will be used (e.g. as an x or y coordinate, as a coloring variable or a size variable, etc).\n    \n    \n    \nBelow, we define our first ggplot object using the `ggplot` function, with the gapminder dataset and the x and y aesthetics defined by the `gdpPercap` and `lifeExp` variables, respectively. \n\nThe output of this function is a grid with `gdpPercap` as the x-axis and `lifeExp` as the y-axis. However, we have not yet told ggplot what type of geometric object the data will be mapped to, so no data has been displayed.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder, aes(x = gdpPercap, y = lifeExp))\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Aesthetic mapping to layers\n\nNext, we will add a \"geom\" layer to our ggplot object. For example, we could add a points layer which would automatically adopt the aesthetic mapping described in the previous line of code.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# describe the base ggplot object and tell it what data we are interested in along with the aesthetic mapping\nggplot(gapminder, aes(x = gdpPercap, y = lifeExp)) +\n  # add a points layer on top\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nWhat we have done is map each country (row) in the data to a point in the space defined by the GDP and life expectancy value. The end result is an ugly blob of points. Fortunately, there are many things that we can do to make this blob of points prettier.\n\nFor example, we can change the transparency of all points by setting the alpha argument to a low value, changing the color of the points to be blue instead of black, and making the points smaller.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder, aes(x = gdpPercap, y = lifeExp)) +\n  geom_point(alpha = 0.5, col = \"cornflowerblue\", size = 0.5)\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\nNote that the above argument changed the alpha value and color for *all of the points at once*. \n\nOne of the truly powerful features of ggplot2 is the ability to change these aesthetics based on the data itself. For example, perhaps we want to color each point by its `continent`. Instead of separating the data into five different subsets (based on the possible values of continent), and adding the different colored points separately, we can simply add all the points once and add an colour aesthetic map for `continent`.\n\nNote that whenever we are using a variable from the data to describe an aesthetic property of a geom, this aesthetic property needs to be included in the `aes()` function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(gapminder$continent)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Asia\"     \"Europe\"   \"Africa\"   \"Americas\" \"Oceania\" \n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder, aes(x = gdpPercap, y = lifeExp, color = continent)) +\n  geom_point(alpha = 0.5, size = 0.5)\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nWe could also add aesthetic mappings for other features such as shape, size, transparency (alpha), and more! For example, changing the size based on population:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +\n  geom_point(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Types of layers\n\nSo far, we have only seen scatterplots (point geoms), however, there are many other geoms we could add, including:\n\n- lines\n\n- histograms\n\n- boxplots and violin plots\n\n- barplots\n\n- smoothed curves\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder, aes(x = year, y = lifeExp, group = country, color = continent)) +\n  geom_line(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=672}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder, aes(x = continent, y = lifeExp, fill = continent)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=672}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder, aes(x = lifeExp)) + \n  geom_histogram(binwidth = 3)\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=672}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder, aes(x = gdpPercap, y = lifeExp, size = pop)) +\n  geom_point(aes(color = continent), alpha = 0.5) +\n  geom_smooth(se = FALSE, method = \"loess\", color = \"grey30\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: The following aesthetics were dropped during statistical transformation: size\nℹ This can happen when ggplot fails to infer the correct grouping structure in\n  the data.\nℹ Did you forget to specify a `group` aesthetic or to convert a numerical\n  variable into a factor?\n```\n:::\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n## Scales\n\nWe are going to return to our original scatterplot example to discuss scales, legend and positioning. \n\nTo remind you, this scatterplot showed GDP per capita against life expectancy for each country colored by continent and sized by population.  \n\nTo keep things simple, let's filter to a single year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\ngapminder_2007 <- gapminder %>% filter(year == 2007)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +\n  geom_point(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nThe scale of a plot describes the features of the space in which it is plotted. Arguably, it would be better to show `gdpPercap` on a logarithmic scale, rather than in its raw form. Fortunately, this is easy to do using a `scale` function, which can be considered another layer that transforms our plot.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +\n  geom_point(alpha = 0.5) +\n  scale_x_log10()\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nThe default x- (and y-) axes scales are `scale_x_continuous` and `scale_y_continuous`, but other options include `scale_x_sqrt` and `scale_x_reverse`.\n\nEach of these scale functions has many options including changing the limits, the breaks, etc. For example in the plot below, we manipulate the x-axis by providing arguments to our `scale` function of choice.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +\n  geom_point(alpha = 0.5) +\n  # clean the x-axis breaks\n  scale_x_log10(breaks = c(1, 10, 100, 1000, 10000),\n                limits = c(1, 120000))\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-17-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nNotice that we changed the name of the x-axis in the plot using the `name` argument. This could also be done using the `labs` function. As an example, below we add a title and change the name of the y-axis and legends using the `labs` function.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +\n  # add scatter points\n  geom_point(alpha = 0.5) +\n  # log-scale the x-axis\n  scale_x_log10() +\n  # change labels\n  labs(title = \"GDP versus life expectancy in 2007\",\n       x = \"GDP per capita (log scale)\",\n       y = \"Life expectancy\",\n       size = \"Popoulation\",\n       color = \"Continent\")\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-18-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nWe could also manipulate the scale of the size variable. Below, we expand the range of sizes and clean up the variable name. Since the variable we provided for size is a continuous variable (`pop`) we use the `scale_size_continuous` argument.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +\n  # add scatter points\n  geom_point(alpha = 0.5) +\n  # log-scale the x-axis\n  scale_x_log10() +\n  # change labels\n  labs(title = \"GDP versus life expectancy in 2007\",\n       x = \"GDP per capita (log scale)\",\n       y = \"Life expectancy\",\n       size = \"Popoulation (millions)\",\n       color = \"Continent\") +\n  # change the size scale\n  scale_size(range = c(0.1, 10),\n             breaks = 1000000 * c(250, 500, 750, 1000, 1250),\n             labels = c(\"250\", \"500\", \"750\", \"1000\", \"1250\")) \n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-19-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nScales also exist for other aesthetic features such as `fill`, `color`, `alpha`, etc.\n\n## Faceting\n\nSometimes we want to be able to make multiple plots of the same thing across different categories. This can be achieved with minimal repetition using faceting.\n\nIn the example below, we will remake the plot above individually for each continent.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +\n  # add scatter points\n  geom_point(alpha = 0.5) +\n  # log-scale the x-axis\n  scale_x_log10() +\n  # change labels\n  labs(title = \"GDP versus life expectancy in 2007\",\n       x = \"GDP per capita (log scale)\",\n       y = \"Life expectancy\",\n       size = \"Popoulation (millions)\",\n       color = \"Continent\") +\n  # change the size scale\n  scale_size(range = c(0.1, 10),\n             breaks = 1000000 * c(250, 500, 750, 1000, 1250),\n             labels = c(\"250\", \"500\", \"750\", \"1000\", \"1250\")) +\n  # add faceting\n  facet_wrap(~continent)\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-20-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n## Themes: making even more beautiful figures with ggplot2\n\nOne of the first things I usually do when I make a ggplot is edit the default theme. I actually really don't like the grey background, nor do I like having a grid unless it really helps with the plot interpretation.\n\nOne of the simplest themes is `theme_classic`, however there are several other themes to choose from. The `ggthemes` package offers many additional themes, but you could also make your own using the `theme()` function.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) +\n  # add scatter points\n  geom_point(alpha = 0.5) +\n  # clean the axes names and breaks\n  scale_x_log10(breaks = c(1000, 10000),\n                limits = c(200, 120000)) +\n  # change labels\n  labs(title = \"GDP versus life expectancy in 2007\",\n       x = \"GDP per capita (log scale)\",\n       y = \"Life expectancy\",\n       size = \"Popoulation (millions)\",\n       color = \"Continent\") +\n  # change the size scale\n  scale_size(range = c(0.1, 10),\n             breaks = 1000000 * c(250, 500, 750, 1000, 1250),\n             labels = c(\"250\", \"500\", \"750\", \"1000\", \"1250\")) +\n  # add a nicer theme\n  theme_classic(base_family = \"Avenir\")\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-21-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nAs an example of further customization of the ggplot theme, below we do the following:\n\n- move the legend to the top (set `legend.position = \"top\"` in `theme()`)\n- removing the population legend (set `guide = \"none\"` in `scale_size()`)\n- remove the axes lines (set `axis.line = element_blank()` in `theme()`)\n- add some text annotations (add `geom_text` layer)\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(gapminder_2007) +\n  # add scatter points\n  geom_point(aes(x = gdpPercap, y = lifeExp, color = continent, size = pop),\n             alpha = 0.5) +\n  # add some text annotations for the very large countries\n  geom_text(aes(x = gdpPercap, y = lifeExp + 3, label = country),\n            color = \"grey50\",\n            data = filter(gapminder_2007, pop > 1000000000 | country %in% c(\"Nigeria\", \"United States\"))) +\n  # clean the axes names and breaks\n  scale_x_log10(limits = c(200, 60000)) +\n  # change labels\n  labs(title = \"GDP versus life expectancy in 2007\",\n       x = \"GDP per capita (log scale)\",\n       y = \"Life expectancy\",\n       size = \"Popoulation\",\n       color = \"Continent\") +\n  # change the size scale\n  scale_size(range = c(0.1, 10),\n             # remove size legend\n             guide = \"none\") +\n  # add a nicer theme\n  theme_classic() +\n  # place legend at top and grey axis lines\n  theme(legend.position = \"top\",\n        axis.line = element_line(color = \"grey85\"),\n        axis.ticks = element_line(color = \"grey85\"))\n```\n\n::: {.cell-output-display}\n![](2017-11-17-ggplot2_tutorial_files/figure-html/unnamed-chunk-22-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n## Saving your plots\n\nYou can save your plots using the `ggsave()` function.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np <- ggplot(gapminder_2007) +\n  # add scatter points\n  geom_point(aes(x = gdpPercap, y = lifeExp, color = continent, size = pop),\n             alpha = 0.5) +\n  # add some text annotations for the very large countries\n  geom_text(aes(x = gdpPercap, y = lifeExp + 3, label = country),\n            color = \"grey50\",\n            data = filter(gapminder_2007, pop > 1000000000 | country %in% c(\"Nigeria\", \"United States\"))) +\n  # clean the axes names and breaks\n  scale_x_log10(limits = c(200, 60000)) +\n  # change labels\n  labs(title = \"GDP versus life expectancy in 2007\",\n       x = \"GDP per capita (log scale)\",\n       y = \"Life expectancy\",\n       size = \"Popoulation\",\n       color = \"Continent\") +\n  # change the size scale\n  scale_size(range = c(0.1, 10),\n             # remove size legend\n             guide = \"none\") +\n  # add a nicer theme\n  theme_classic() +\n  # place legend at top and grey axis lines\n  theme(legend.position = \"top\",\n        axis.line = element_line(color = \"grey85\"),\n        axis.ticks = element_line(color = \"grey85\"))\n\n# save the plot\nggsave(\"beautiful_plot.png\", p, dpi = 300, width = 6, height = 4)\n```\n:::",
    "supporting": [
      "2017-11-17-ggplot2_tutorial_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}