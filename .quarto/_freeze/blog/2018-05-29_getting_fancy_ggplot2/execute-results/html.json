{
  "hash": "d8790f34ffa9915cc838b153285f69a8",
  "result": {
    "markdown": "---\ntitle:  \"Getting fancy with ggplot2: code for alternatives to grouped bar charts\"\nauthor: \"Rebecca Barter\"\noutput:\n  html:\n    toc: true\ncategories: [R, visualization]\ndate: 2018-05-29\ndescription: \"In this post I present the code I wrote to prodocue the figures in my previous post about alternatives to grouped bar charts.\" \n---\n\n\n\nHere I provide the code I used to create the figures from my [previous post on alternatives to grouped bar charts](../2018-05-29_alternatives_dodged_bars/index.html). You are encouraged to play with them yourself!\n\nThe key to creating unique and creative visualizations using libraries such as ggplot (or even just straight SVG) is (1) to move away from thinking of data visualization only as the default plot types (bar plots, boxplots, scatterplots, etc), and (2) to realise that most visualizations are essentially lines and circles that you can arrange however you desire in space. Drawing a picture on paper before beginning to code your data viz is a great way to create customized visualizations for each dataset.\n\n# Bars \n\nFirst, I load in the libraries (the data comes from the `dslabs` library), and convert the data to long-form for creating the grouped bar charts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load in libraries\nlibrary(tidyverse)\nlibrary(dslabs)\n# combine male and female success rates into single data frame\nsuccess_rates <- rbind(\n  # male success rates\n  transmute(research_funding_rates, \n            discipline, \n            success = success_rates_men, \n            gender = \"Male\"),\n  # female success rates\n  transmute(research_funding_rates, \n            discipline, \n            success = success_rates_women, \n            gender = \"Female\")) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# print the data\nsuccess_rates\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            discipline success gender\n1    Chemical sciences    26.5   Male\n2    Physical sciences    19.3   Male\n3              Physics    26.9   Male\n4           Humanities    14.3   Male\n5   Technical sciences    15.9   Male\n6    Interdisciplinary    11.4   Male\n7  Earth/life sciences    24.4   Male\n8      Social sciences    15.3   Male\n9     Medical sciences    18.8   Male\n10   Chemical sciences    25.6 Female\n11   Physical sciences    23.1 Female\n12             Physics    22.2 Female\n13          Humanities    19.3 Female\n14  Technical sciences    21.0 Female\n15   Interdisciplinary    21.8 Female\n16 Earth/life sciences    14.3 Female\n17     Social sciences    11.5 Female\n18    Medical sciences    11.2 Female\n```\n:::\n:::\n\n\n\n\nI used `geom_bar()` to create a grouped bar chart containing the data. I grouped by gender by setting `fill = gender` within the `aes()` function.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# make grouped bar plot\nggplot(success_rates) +\n  # add bar for each discipline colored by gender\n  geom_bar(aes(x = discipline, y = success, fill = gender),\n           stat = \"identity\", position = \"dodge\") +\n  # name axes and remove gap between bars and y-axis\n  scale_y_continuous(\"Success Rate\", expand = c(0, 0)) +\n  scale_x_discrete(\"Discipline\") +\n  scale_fill_manual(values = c(\"#468189\", \"#9DBEBB\")) +\n  # remove grey theme\n  theme_classic(base_size = 18) +\n  # rotate x-axis and remove superfluous axis elements\n  theme(axis.text.x = element_text(angle = 90, \n                                   hjust = 1, vjust = 0),\n        axis.line = element_blank(),\n        axis.ticks.x = element_blank()) \n```\n\n::: {.cell-output-display}\n![](2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n# Slope plot\n\nTo create the sloped chart, it ends up being easier to keep the data in its original wide form.\n\n\nThe first element I add is the slopes from men to women using `geom_segment()`. Each slope is colored based on whether men or women are more successful.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngg_slope <- research_funding_rates %>%\n  # add a variable for when men are more successful than women (for colours)\n  mutate(men_more_successful = success_rates_men > success_rates_women) %>%\n  ggplot() +\n  # add a line segment that goes from men to women for each discipline\n  geom_segment(aes(x = 1, xend = 2, \n                   y = success_rates_men, \n                   yend = success_rates_women,\n                   group = discipline,\n                   col = men_more_successful), \n               size = 1.2) +\n  # set the colors\n  scale_color_manual(values = c(\"#468189\", \"#9DBEBB\"), guide = \"none\")  +\n  # remove all axis stuff\n  theme_classic() + \n  theme(axis.line = element_blank(),\n        axis.text = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks = element_blank()) \ngg_slope\n```\n\n::: {.cell-output-display}\n![](2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nNext, I add a left and right axis at the start and end of the slopes.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngg_slope <- gg_slope +\n  # add vertical lines that act as axis for men\n  geom_segment(x = 1, xend = 1, \n               y = min(research_funding_rates$success_rates_men) - 2,\n               yend = max(research_funding_rates$success_rates_men) + 1,\n               col = \"grey70\", size = 0.5) +\n  # add vertical lines that act as axis for women\n  geom_segment(x = 2, xend = 2, \n               y = min(research_funding_rates$success_rates_men) - 2,\n               yend = max(research_funding_rates$success_rates_men) + 1,\n               col = \"grey70\", size = 0.5) +\n  # add the words \"men\" and \"women\" above their axes\n  geom_text(aes(x = x, y = y, label = label),\n            data = data.frame(x = 1:2, \n                              y = 2 + max(research_funding_rates$success_rates_men),\n                              label = c(\"men\", \"women\")),\n            col = \"grey30\",\n            size = 6) \ngg_slope  \n```\n\n::: {.cell-output-display}\n![](2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nI also need to add an identifier for each discipline's slope. I do this by annotating the plot with text.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngg_slope <- gg_slope +\n  # add the label and success rate for each discipline next the men axis\n  geom_text(aes(x = 1 - 0.03, \n                y = success_rates_men, \n                label = paste0(discipline, \", \", \n                               round(success_rates_men, 1), \"%\")),\n             col = \"grey30\", hjust = \"right\") +\n  # add the success rate next to each point on the women axis\n  geom_text(aes(x = 2 + 0.08, \n                y = success_rates_women, \n                label = paste0(round(success_rates_women, 1), \"%\")),\n            col = \"grey30\") +\n  # set the limits of the x-axis so that the labels are not cut off\n  scale_x_continuous(limits = c(0.5, 2.1)) \ngg_slope\n```\n\n::: {.cell-output-display}\n![](2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nFinally, I decide to add points (for aesthetic purposes). Behind each circle, I add a slightly larger white circle to act as a border and to give a slight \"gap\" look.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngg_slope <- gg_slope + \n  \n  # add the white outline for the points at each rate for men\n  geom_point(aes(x = 1, \n                 y = success_rates_men), size = 4.5,\n             col = \"white\") +\n  # add the white outline for the points at each rate for women\n  geom_point(aes(x = 2, \n                 y = success_rates_women), size = 4.5,\n             col = \"white\") +\n  \n  # add the actual points at each rate for men\n  geom_point(aes(x = 1, \n                 y = success_rates_men), size = 4,\n             col = \"grey60\") +\n  # add the actual points at each rate for men\n  geom_point(aes(x = 2, \n                 y = success_rates_women), size = 4,\n             col = \"grey60\") \ngg_slope\n```\n\n::: {.cell-output-display}\n![](2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n# Horizontal dots\n\nTo create the horizontal dot plot, I again keep the data in its original wide-form but I arrange the disciplines in order of women's success rate (this will make the plot easier to read).\n\nThe first things I do to create the dot plot is add the horizontal discipline lines and the points for the success rates of men and women. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngg_dot <- research_funding_rates %>%\n  # rearrange the factor levels for discipline by rates for women\n  arrange(success_rates_women) %>%\n  mutate(discipline = fct_inorder(discipline)) %>%\n  \n  ggplot() +\n  # remove axes and superfluous grids\n  theme_classic() +\n  theme(axis.title = element_blank(),\n        axis.ticks.y = element_blank(),\n        axis.line = element_blank()) +\n  \n  \n  # add a dummy point for scaling purposes\n  geom_point(aes(x = 12, y = discipline), \n             size = 0, col = \"white\") + \n  \n  # add the horizontal discipline lines\n  geom_hline(yintercept = 1:9, col = \"grey80\") +\n  \n  # add a point for each male success rate\n  geom_point(aes(x = success_rates_men, y = discipline), \n             size = 11, col = \"#9DBEBB\") +\n  # add a point for each female success rate\n  geom_point(aes(x = success_rates_women, y = discipline),\n             size = 11, col = \"#468189\") \ngg_dot\n```\n\n::: {.cell-output-display}\n![](2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=768}\n:::\n:::\n\n\nSince I really like to annotate my figures with text so that the audience can work less hard, I add the success rate on top of each dot. I also prefer to annotate features my plot directly instead of using legends, so I also add a label for men and women.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngg_dot <- gg_dot + \n  # add the text (%) for each male success rate\n  geom_text(aes(x = success_rates_men, y = discipline, \n                label = paste0(round(success_rates_men, 1))),\n            col = \"black\") +\n  # add the text (%) for each female success rate\n  geom_text(aes(x = success_rates_women, y = discipline, \n                label = paste0(round(success_rates_women, 1))),\n            col = \"white\") +\n  # add a label above the first two points\n  geom_text(aes(x = x, y = y, label = label, col = label),\n            data.frame(x = c(25.6 - 1.1, 26.5 + 0.6), y = 10, \n                       label = c(\"women\", \"men\")), size = 6) +\n  scale_color_manual(values = c(\"#9DBEBB\", \"#468189\"), guide = \"none\") +\n  \n  # manually specify the x-axis\n  scale_x_continuous(breaks = c(15, 20, 25), \n                     labels = c(\"15%\", \"20%\", \"25%\")) +\n  # manually set the spacing above and below the plot\n  scale_y_discrete(expand = c(0.2, 0)) \ngg_dot\n```\n\n::: {.cell-output-display}\n![](2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n\n# References\n\n- The research funding data comes from Rafael Irizarry's `dslabs` R package\n\n- The slope and dot plot ideas for this post come from [Ann K. Emery's post](http://annkemery.com/clustered-bar-chart/) on the same topic. ",
    "supporting": [
      "2018-05-29_getting_fancy_ggplot2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}